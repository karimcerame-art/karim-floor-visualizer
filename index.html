<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Floor Visualizer</title>

<style>
  body {
    margin: 0;
    background: #f5f5f5;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    text-align: center;
  }
  canvas {
    width: 100%;
    max-width: 500px;
    margin-top: 10px;
  }
</style>
</head>

<body>

<canvas id="canvas"></canvas>

<script>
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");

let baseImage = new Image();
let laminateImage = new Image();
let floorMask = null;

/* =========================
   CALLED FROM iOS (Swift)
   ========================= */

function loadImage(base64) {
  baseImage.onload = () => {
    canvas.width = baseImage.width;
    canvas.height = baseImage.height;
    ctx.drawImage(baseImage, 0, 0);
  };
  baseImage.src = "data:image/jpeg;base64," + base64;
}

function applyLaminate(code) {
  laminateImage.onload = () => {
    drawLaminate();
  };
  laminateImage.src =
    "https://karimcerame-art.github.io/karim-floor-visualizer/laminates/" +
    code + ".png";
}

/* =========================
   SIMPLE FLOOR APPLY LOGIC
   ========================= */

function drawLaminate() {
  if (!baseImage.complete || !laminateImage.complete) return;

  // redraw base
  ctx.drawImage(baseImage, 0, 0);

  // repeat laminate
  let pattern = ctx.createPattern(laminateImage, "repeat");
  ctx.globalAlpha = 0.85;
  ctx.fillStyle = pattern;

  // bottom half = floor (simple but works)
  ctx.fillRect(
    0,
    canvas.height * 0.55,
    canvas.width,
    canvas.height * 0.45
  );

  ctx.globalAlpha = 1.0;
}
</script>

</body>
</html>
