<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { margin:0; background:#f5f5f5; font-family:-apple-system }
canvas { width:100%; height:auto; display:block }
button {
  width:90%;
  padding:14px;
  margin:10px auto;
  display:block;
  background:black;
  color:white;
  border:none;
  border-radius:10px;
  font-size:16px;
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>

<div id="laminates" style="display:none">
  <button onclick="applyLaminate('laminates/10CI56580.png')">10CI56580</button>
  <button onclick="applyLaminate('laminates/10CI52799.png')">10CI52799</button>
  <button onclick="applyLaminate('laminates/10CI56582.png')">10CI56582</button>
  <button onclick="closePicker()">Cancel</button>
</div>

<script>
let baseImg = new Image()
let canvas = document.getElementById('canvas')
let ctx = canvas.getContext('2d')

function loadImage(b64) {
  baseImg.onload = () => {
    canvas.width = baseImg.width
    canvas.height = baseImg.height
    ctx.drawImage(baseImg,0,0)
  }
  baseImg.src = 'data:image/jpeg;base64,' + b64
}

function openLaminatePicker() {
  document.getElementById('laminates').style.display = 'block'
}

function closePicker() {
  document.getElementById('laminates').style.display = 'none'
}

function applyLaminate(src) {
  let tex = new Image()
  tex.onload = () => {
    ctx.globalAlpha = 0.85
    ctx.drawImage(tex,0,canvas.height/2,canvas.width,canvas.height/2)
    sendResult()
  }
  tex.src = src
}

function sendResult() {
  let b64 = canvas.toDataURL('image/jpeg').split(',')[1]
  window.webkit.messageHandlers.result.postMessage(b64)
}
</script>

</body>
</html>
